name: Verify Required Secrets

on:
  push:
    branches: [ main ]

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check required secrets
        env:
          STRIPE_WEBHOOK_SECRET: ${{ secrets.STRIPE_WEBHOOK_SECRET }}
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
          XENDIT_API_KEY: ${{ secrets.XENDIT_API_KEY }}
          MIDTRANS_SERVER_KEY: ${{ secrets.MIDTRANS_SERVER_KEY }}
        run: |
          MISSING=0
          if [ -z "$STRIPE_WEBHOOK_SECRET" ]; then echo "Missing STRIPE_WEBHOOK_SECRET"; MISSING=1; fi
          if [ -z "$JWT_SECRET" ]; then echo "Missing JWT_SECRET"; MISSING=1; fi
          if [ -z "$XENDIT_API_KEY" ] && [ -z "$MIDTRANS_SERVER_KEY" ]; then echo "Missing both XENDIT_API_KEY and MIDTRANS_SERVER_KEY (at least one required)"; MISSING=1; fi
          if [ $MISSING -eq 1 ]; then exit 1; fi
